{% extends 'custom-templates/base.html' %} {% load static %}
{% block title %} Disbursement {% endblock %} 
{% load bootstrap3 %}
{% block stock_receive_content %}
{% csrf_token %}

<!-- <form id="frm-example" method="POST">
    {% csrf_token %} -->

<!-- {% if message %}
    <p class="login-box-msg" style="color: red;">{{ message }}</p>
{% endif %} -->
<!-- SELECT2 EXAMPLE -->
<div class="card card-info">
    <div class="card-header">
      <h3 class="card-title">Disbursement</h3>
      <div class="card-tools">
        <button type="button" class="btn btn-tool" data-card-widget="collapse">
          <i class="fas fa-minus"></i>
        </button>
        <button type="button" class="btn btn-tool" data-card-widget="remove">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
    <!-- /.card-header -->
    <div class="card-body" style="overflow:auto">
        <div class="row">
        <div class="col-md-6">
            <input type="hidden" name="csrftoken" value="{{csrf_token}}" id="csrf_token">
            <div class="form-group">
              <label>Old Loan Proposal Id <span style="color: red">*</span></label>
              <input type="text" value="{{disburselist.loanAppNo}}" class="form-control" placeholder="" id="oldLoanProposalId">
            </div>
        </div>
          <div class="col-2 mt-3">
            {% comment %} {% bootstrap_button 'Filter' button_class="btn-secondary" %} {% endcomment %}
            <button type="submit" class="btn btn-primary mr-3 mt-3 btn-block" id="get-loan-id-data">Get Data</button>
          </div>
        <!-- /.col -->
      </div>
      <!-- /.row -->
    </div>
    <!-- /.card-body -->
  </div>
  <!-- /.card -->


  <div class="card card-info">
    <div class="card-header">
      <h3 class="card-title"></h3>
      <div class="card-tools">
        <button type="button" class="btn btn-tool" data-card-widget="collapse">
          <i class="fas fa-minus"></i>
        </button>
        <button type="button" class="btn btn-tool" data-card-widget="remove">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
    <!-- /.card-header -->
    <div class="card-body" style="overflow:auto">
        <form action="" method="post">
            {% csrf_token %}
        <div class="row">
            <input type="hidden" class="form-control" name="loanAppNo" placeholder="" value=""   id="loanAppNo">
        <div class="col-md-6">
            <div class="form-group">
                <label>Item:</label>
                &nbsp;<label>{{item.productName}}</label>
                <!-- <input type="text" class="form-control" name="itemname" placeholder="" value="{{item.productName}}" id="disburse-item"> -->
              </div>
        </div>

        <div class="col-md-6">
            <div class="form-group">
                <label>SKU:</label>
                &nbsp;<label>{{item.sku}}</label>
                <!-- <input type="text" class="form-control" name="sku" placeholder="" value="{{item.sku}}" id="disburse-sku"> -->
              </div>
        </div>

        <div class="col-md-6">
            <div class="form-group">
                <label>Quantity:</label>
                &nbsp;<label>{{stock.quantity}}</label>
                <!-- <input type="text" class="form-control" name="item-quantity" placeholder="" value="" id="disburse-quantity"> -->
              </div>
        </div>

        <div class="col-md-6">
            <div class="form-group">
                <label>New Loan App No <span style="color: red">*</span></label>
                <input type="text" class="form-control" name="newLoanID" placeholder="" value="" id="newLoanID">
              </div>
        </div>

        <div class="col-md-6">
            <div class="form-group">
                <label>Invoice Number <span style="color: red">*</span></label>
                <input type="text" class="form-control" name="invoiceNo" placeholder="" value="{{disburselist.invoiceNo}}" id="invoiceNo" readonly>
              </div>
        </div>

        <div class="col-md-6">
            <div class="form-group">
                <label>IMEI No. <span style="color: red">*(only in case of Mobile)</span></label>
                <input type="text" class="form-control" name="imei-number" placeholder="" value="" id="imei-number" readonly>
              </div>
        </div>

        {% comment %} <div class="col-md-6">
            <div class="form-group">
                <label>New Loan App No *</label>
                <input type="text" class="form-control" name="new-loanAppNo" placeholder="" value="" id="disburse-new-loan">
              </div>
        </div> {% endcomment %}

        <div class="col-md-6">
            <div class="form-group">
                <label>Customer Name <span style="color: red">*</span></label>
                <input type="text" class="form-control" name="customerName" placeholder="" value="" id="customerName">
              </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label>Customer Id <span style="color: red">*</span></label>
                <input type="text" class="form-control" name="customerID" placeholder="" value="{{disburselist.customerID}}" id="customerID">
              </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label>Phone <span style="color: red">*</span></label>
                <input type="text" class="form-control" name="Phone" placeholder="" value="" id="Phone">
              </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label>Address <span style="color: red">*</span></label>
                <input type="text" class="form-control" name="address" placeholder="" value="" id="address">
              </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label>Address State <span style="color: red">*</span></label>
                <input type="text" class="form-control" name="addressState" placeholder="" value="" id="addressState">
              </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label>Address Zip Code <span style="color: red">*</span></label>
                <input type="text" class="form-control" name="addressZipCode" placeholder="" value="" id="addressZipCode">
              </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label>Delivery Date <span style="color: red">*</span></label>
                <input type="text" class="form-control" name="disbursementDate" placeholder="dd/mm/yyyy" value="" id="disbursementDate">
              </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label>Application Date <span style="color: red">*</span></label>
                <input type="text" class="form-control" name="updatedDate" placeholder="dd/mm/yyyy" value="" id="updatedDate">
              </div>
        </div>
    </div>
    <!-- /.row -->
        <div class="row">
          <div class="col-4">
            {% comment %} {% bootstrap_button 'Filter' button_class="btn-secondary" %} {% endcomment %}
            <button type="submit" class="btn btn-primary mr-3 mt-3 btn-block" id="disburse-button">Disburse</button>
          </div>
          <!-- /.col -->
        </div>
        <!-- /.row -->
    </form>
    </div>
    <!-- /.card-body -->
  </div>
  <!-- /.card -->

<!-- <p><b>Selected rows data:</b></p>
<pre id="example-console-rows"></pre> -->

<!-- </form> -->

{% endblock %}

{% block javascript %}
<!-- jQuery -->
<script src="{% static 'admin-lte/plugins/jquery/jquery.min.js' %}"></script>
<!-- Bootstrap 4 -->
<script src="{% static 'admin-lte/plugins/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
<!-- Select2 -->
<script src="{% static 'admin-lte/plugins/select2/js/select2.full.min.js' %}"></script>
<!-- Bootstrap4 Duallistbox -->
<script src="{% static 'admin-lte/plugins/bootstrap4-duallistbox/jquery.bootstrap-duallistbox.min.js' %}"></script>
<!-- InputMask -->
<script src="{% static 'admin-lte/plugins/moment/moment.min.js' %}"></script>
<script src="{% static 'admin-lte/plugins/inputmask/jquery.inputmask.min.js' %}"></script>

<script src="{% static 'admin-lte/plugins/daterangepicker/daterangepicker.js' %}"></script>

  <link rel="stylesheet" type="text/css" 
  href="https://cdn.datatables.net/1.10.23/css/jquery.dataTables.css">
  <script type="text/javascript" charset="utf8" 
  src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.js"></script>
  
  <link type="text/css" href="//gyrocode.github.io/jquery-datatables-checkboxes/1.2.12/css/dataTables.checkboxes.css" rel="stylesheet" />
  <script type="text/javascript" src="//gyrocode.github.io/jquery-datatables-checkboxes/1.2.12/js/dataTables.checkboxes.min.js"></script>

<script>
$(document).ready(function() {
    $('#get-loan-id-data').on("click", function(e) {
        e.preventDefault();
        var oldLoanProposalId = $('#oldLoanProposalId').val();
        var csrftoken = $('#csrf_token').val();
        $.ajax(
            {
            type:"POST",
            url: "getold-loan-data",
            data:{
                'csrfmiddlewaretoken': csrftoken,
                'loanAppNo': oldLoanProposalId,
            },
            success: function(response)   
            {
              //var responseJson = JSON.parse(response.data)[0].fields
                console.log('data:', response.data);

                $('#disburse-item').val(response.data.item)
                $('#disburse-sku').val(response.data.sku)
                $('#disburse-quantity').val(response.data.quantity)
                $('#invoiceNo').val(response.data.invoiceNumber)
            },
            error: function(error){
                console.log('error: ', error);
            }
        });
    });
});



$(function () {
      //Initialize Select2 Elements
    //   $('.select2').select2()

    //   //Initialize Select2 Elements
    //   $('.select2bs4').select2({
    //     theme: 'bootstrap4'
    //   })

      //Datemask dd/mm/yyyy
      $('#datemask').inputmask('dd/mm/yyyy', { 'placeholder': 'dd/mm/yyyy' })
      //Datemask2 mm/dd/yyyy
      $('#datemask2').inputmask('mm/dd/yyyy', { 'placeholder': 'mm/dd/yyyy' })
      //Money Euro
      $('[data-mask]').inputmask()

      //Date range picker
    //   $('#reservationdate').datepicker();
    $(document).ready(function() {
          
          $(function() {
              $( "#reservationdate" ).datepicker();
              $('.date-picker').on("click", function() {
                $( "#reservationdate" ).datepicker('show');
              })
          });
      })
      //Date range picker
    //   $('#reservation').daterangepicker()
      //Date range picker with time picker
      $('#reservationtime').daterangepicker({
        timePicker: true,
        timePickerIncrement: 30,
        locale: {
          format: 'MM/DD/YYYY hh:mm A'
        }
      })
      //Date range as a button
      $('#daterange-btn').daterangepicker(
        {
          ranges   : {
            'Today'       : [moment(), moment()],
            'Yesterday'   : [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
            'Last 7 Days' : [moment().subtract(6, 'days'), moment()],
            'Last 30 Days': [moment().subtract(29, 'days'), moment()],
            'This Month'  : [moment().startOf('month'), moment().endOf('month')],
            'Last Month'  : [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
          },
          startDate: moment().subtract(29, 'days'),
          endDate  : moment()
        },
        function (start, end) {
          $('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'))
        }
      )

      //Timepicker
    //   $('#timepicker').datetimepicker({
    //     format: 'LT'
    //   })

      //Bootstrap Duallistbox
      $('.duallistbox').bootstrapDualListbox()

      $("input[data-bootstrap-switch]").each(function(){
        $(this).bootstrapSwitch('state', $(this).prop('checked'));
      });

    })


</script>

{% endblock %}